{% extends 'base.html' %}
{% load static %}

{% block title %}Home - CookFoodHub{% endblock %}

{% block content %}

<section class="position-relative hero-section">
  <!-- HERO IMAGE -->
  <img src="{% static 'home/images/hero.jpg' %}" class="img-fluid w-100 hero-img" alt="Hero Image">

  <!-- DARK OVERLAY -->
  <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark opacity-25"></div>

  <!-- TEXT OVERLAY -->
  <div class="hero-text position-absolute top-50 start-50 translate-middle text-center text-white">
    <h2 class="display-4">Welcome to CookFoodHub!</h2>
    <p class="lead">Your favorite place for delicious recipes.</p>
    <a href="{% url 'recipe_list' %}" class="btn btn-danger btn-lg mt-3">View Recipes</a>
  </div>
</section>

<!-- ========================= -->
<!--        WHAT WE DO         -->
<!-- ========================= -->
<section class="py-5 bg-light border-top">
  <div class="container text-center">

    <h2 class="fw-bold mb-4">What We Do</h2>
    <p class="text-muted mx-auto mb-5" style="max-width: 700px;">
      At <span class="fw-semibold">CookFoodHub</span>, we bring food lovers together.
      Discover tasty recipes, share your own creations, connect with a friendly cooking
      community, and find endless inspiration for every meal.
    </p>

    <div class="row g-4">
      <div class="col-md-4">
        <div class="p-4 bg-white shadow-sm rounded h-100">
          <div class="mb-3">
            <i class="bi bi-book-half fs-1 text-danger"></i>
          </div>
          <h5 class="fw-bold">Explore New Recipes</h5>
          <p class="text-muted small">
            Browse a growing collection of unique, homemade, and trending dishes created by our community.
          </p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="p-4 bg-white shadow-sm rounded h-100">
          <div class="mb-3">
            <i class="bi bi-people fs-1 text-danger"></i>
          </div>
          <h5 class="fw-bold">Join the Community</h5>
          <p class="text-muted small">
            Connect with other food lovers, share tips, comment on dishes, and build cooking friendships.
          </p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="p-4 bg-white shadow-sm rounded h-100">
          <div class="mb-3">
            <i class="bi bi-camera fs-1 text-danger"></i>
          </div>
          <h5 class="fw-bold">Share Your Creations</h5>
          <p class="text-muted small">
            Upload your own recipes and photos to inspire others and show off your cooking skills.
          </p>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- TOP 3 LIKED RECIPES -->
<section class="container my-5">

  <h2 class="fw-bold caveat text-center mb-4">Top 3 Most Liked Recipes</h2>

  <div class="row g-4">

    {% for recipe in top_recipes %}
    <div class="col-md-4 col-sm-6">
      <div class="card shadow-sm recipe-card h-100" data-href="{% url 'recipe_detail' recipe.pk %}"
        style="cursor:pointer; display:flex; flex-direction:column;">

        {% if recipe.image %}
        <img src="{{ recipe.image.url }}" class="card-img-top" alt="{{ recipe.title }}"
          style="height: 200px; object-fit: cover;">
        {% else %}
        <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height:200px;">
          No Image
        </div>
        {% endif %}

        <div class="card-body d-flex flex-column">

          <h5 class="card-title fw-bold">{{ recipe.title }}</h5>
          <p class="card-text text-muted">{{ recipe.description|truncatewords:20 }}</p>

          <div class="recipe-footer mt-auto d-flex justify-content-between align-items-center">

            <!-- Left: Likes + Comments + Rating -->
            <div class="d-flex align-items-center gap-2">
              <span class="btn btn-outline-danger btn-sm">‚ù§Ô∏è {{ recipe.likes.count }}</span>

              <a href="{% url 'recipe_detail' recipe.pk %}#comments-section" class="btn btn-outline-secondary btn-sm">üí¨
                {{ recipe.comments.count }}</a>

              <!-- Average Rating -->
              <div class="d-flex align-items-center gap-1">
                <i class="fa-solid fa-star text-warning"></i>
                <span>{{ recipe.average_rating|floatformat:1 }}</span>
              </div>
            </div>

            <!-- Right: Save Button (optional) -->
            {% if user.is_authenticated %}
            <form action="{% url 'toggle_save' recipe.pk %}" method="post" class="d-inline">
              {% csrf_token %}
              {% if user in recipe.saved_by.all %}
              <input type="hidden" name="action" value="unsave">
              <button type="submit" class="btn btn-outline-secondary btn-sm">‚ùå Unsave</button>
              {% else %}
              <input type="hidden" name="action" value="save">
              <button type="submit" class="btn btn-outline-danger btn-sm">üíæ Save</button>
              {% endif %}
            </form>
            {% endif %}

          </div>

        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-center text-muted">No recipes yet‚Äîbut they‚Äôre cooking!</p>
    {% endfor %}

  </div>

</section>

<!-- Top rated Recipes Section -->
<hr class="my-5">

<div class="container">

  <h2 class="fw-bold caveat text-center mb-4">Top 3 Rated Recipes</h2>

  <div class="row g-4">

    {% for recipe in top_rated %}
    <div class="col-md-4 col-sm-6">
      <div class="card shadow-sm recipe-card h-100" data-href="{% url 'recipe_detail' recipe.pk %}"
        style="cursor:pointer; display:flex; flex-direction:column;">

        {% if recipe.image %}
        <img src="{{ recipe.image.url }}" class="card-img-top recipe-img" alt="{{ recipe.title }}">
        {% else %}
        <div class="recipe-placeholder bg-secondary text-white d-flex align-items-center justify-content-center">
          No Image
        </div>
        {% endif %}

        <div class="card-body d-flex flex-column">

          <h5 class="card-title fw-bold">{{ recipe.title }}</h5>
          <p class="card-text text-muted">{{ recipe.description|truncatewords:20 }}</p>

          <div class="recipe-footer mt-auto d-flex justify-content-between align-items-center">

            <!-- Left: Likes + Comments + Rating -->
            <div class="d-flex align-items-center gap-2">

              <!-- Likes -->
              <span class="btn btn-outline-secondary btn-sm">
                ‚ù§Ô∏è {{ recipe.likes.count }}
              </span>

              <!-- Comments -->
              <a href="{% url 'recipe_detail' recipe.pk %}#comments-section" class="btn btn-outline-secondary btn-sm">
                üí¨ {{ recipe.comments.count }}
              </a>

              <!-- Average Rating -->
              <div class="d-flex align-items-center gap-1">
                <i class="fa-solid fa-star text-warning"></i>

                <span>
                  {% if recipe.avg_rating %}
                  {{ recipe.avg_rating|floatformat:1 }}
                  {% else %}
                  0.0
                  {% endif %}
                </span>
              </div>

            </div>

            <!-- Right: Save / Unsave -->
            <div>
              {% if user.is_authenticated %}
              <form action="{% url 'toggle_save' recipe.pk %}" method="post" class="d-inline">
                {% csrf_token %}

                {% if user in recipe.saved_by.all %}
                <input type="hidden" name="action" value="unsave">
                <button type="submit" class="btn btn-outline-secondary btn-sm">
                  ‚ùå Unsave
                </button>
                {% else %}
                <input type="hidden" name="action" value="save">
                <button type="submit" class="btn btn-outline-danger btn-sm">
                  üíæ Save
                </button>
                {% endif %}
              </form>
              {% endif %}
            </div>

          </div>

        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-muted text-center">No rated recipes yet.</p>
    {% endfor %}

  </div>
</div>

<div class="text-center mt-4">
  <a href="{% url 'recipe_list' %}" class="hero-text btn btn-danger btn-lg mt-3">Explore Recipes</a>
</div>

{% endblock %}